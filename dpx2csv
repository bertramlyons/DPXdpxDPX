#!/bin/bash
echo "FileName,Magic number,Offset to image data,Version number of header format,Total image file size,Ditto Key,Generic section header length,Industry specific header length,User-defined header length,FileName,Creation Date,Creator,Project,Right to use or copyright statement,Encryption key,Reserved for future use,Image orientation,Number of image elements,Pixels per line,Lines per image element,Data sign,Reference low data code value,Reference low quantity represented,Reference high data code value,Reference high quantity represented,Descriptor,Transfer characteristic,Colorimetric specification,Bit depth,Packing,Encoding,Offset to data,End-of-line padding,End-of-image padding,Description of image element,Padding,Reserved for future use,X Offset,Y Offset,X center,Y center,X original size,Y original size,Source image filename,Source image date/time,Input device name,Input device serial number,XL border,XR border,YT border,YB border,Pixel ratio : horizontal,Pixel ratio : vertical,X scanned size,Y scanned size,Reserved for future use,Film mfg. ID code,Film type,Offset in perfs,Prefix,Count,Format - e.g. Academy,Frame position in sequence,Sequence length (frames),Held count (1 = default),Frame rate of original (frames/s),Shutter angle of camera in degrees,Frame identification - e.g. keyframe,Slate information,Reserved for future use,SMPTE time code,SMPTE user bits,Interlace,Field number,Video signal standard,Zero,Horizontal sampling rate (Hz),Vertical sampling rate (Hz),Temporal sampling rate or frame rate (Hz),Time offset from sync to first pixel (ms),Gamma,Black level code value,Black gain,Breakpoint,Reference white level code value,Integration time (s),Reserved for future use" > dpx_data.csv
for DPXFILE in "${1}/.dpx" ; do
    mediaconch -mt -fx "${DPXFILE}" | xmlstarlet sel -N "mt=https://mediaarea.net/mediatrace" -T -t -m _:MediaTrace/_:media -v @ref -o "," -v //_:data[@offset=0] -o "," -v //_:data[@offset=4] -o "," -v //_:data[@offset=8] -o "," -v //_:data[@offset=16] -o "," -v //_:data[@offset=20] -o "," -v //_:data[@offset=24] -o "," -v //_:data[@offset=28] -o "," -v //_:data[@offset=32] -o "," -v //_:data[@offset=36] -o "," -v //_:data[@offset=136] -o "," -v //_:data[@offset=160] -o "," -v //_:data[@offset=260] -o "," -v //_:data[@offset=460] -o "," -v //_:data[@offset=660] -o "," -v //_:data[@offset=664] -o "," -v //_:data[@offset=768] -o "," -v //_:data[@offset=772] -o "," -v //_:data[@offset=776] -o "," -v //_:data[@offset=780] -o "," -v //_:data[@offset=784] -o "," -v //_:data[@offset=788] -o "," -v //_:data[@offset=792] -o "," -v //_:data[@offset=796] -o "," -v //_:data[@offset=800] -o "," -v //_:data[@offset=801] -o "," -v //_:data[@offset=802] -o "," -v //_:data[@offset=803] -o "," -v //_:data[@offset=804] -o "," -v //_:data[@offset=806] -o "," -v //_:data[@offset=808] -o "," -v //_:data[@offset=812] -o "," -v //_:data[@offset=816] -o "," -v //_:data[@offset=820] -o "," -v //_:data[@offset=852] -o "," -v //_:data[@offset=1356] -o "," -v //_:data[@offset=1408] -o "," -v //_:data[@offset=1412] -o "," -v //_:data[@offset=1416] -o "," -v //_:data[@offset=1420] -o "," -v //_:data[@offset=1424] -o "," -v //_:data[@offset=1428] -o "," -v //_:data[@offset=1432] -o "," -v //_:data[@offset=1532] -o "," -v //_:data[@offset=1556] -o "," -v //_:data[@offset=1588] -o "," -v //_:data[@offset=1620] -o "," -v //_:data[@offset=1622] -o "," -v //_:data[@offset=1624] -o "," -v //_:data[@offset=1628] -o "," -v //_:data[@offset=1632] -o "," -v //_:data[@offset=1636] -o "," -v //_:data[@offset=1640] -o "," -v //_:data[@offset=1644] -o "," -v //_:data[@offset=1664] -o "," -v //_:data[@offset=1666] -o "," -v //_:data[@offset=1668] -o "," -v //_:data[@offset=1670] -o "," -v //_:data[@offset=1676] -o "," -v //_:data[@offset=1680] -o "," -v //_:data[@offset=1712] -o "," -v //_:data[@offset=1716] -o "," -v //_:data[@offset=1720] -o "," -v //_:data[@offset=1724] -o "," -v //_:data[@offset=1728] -o "," -v //_:data[@offset=1732] -o "," -v //_:data[@offset=1764] -o "," -v //_:data[@offset=1864] -o "," -v //_:data[@offset=1920] -o "," -v //_:data[@offset=1924] -o "," -v //_:data[@offset=1928] -o "," -v //_:data[@offset=1929] -o "," -v //_:data[@offset=1930] -o "," -v //_:data[@offset=1931] -o "," -v //_:data[@offset=1932] -o "," -v //_:data[@offset=1936] -o "," -v //_:data[@offset=1940] -o "," -v //_:data[@offset=1944] -o "," -v //_:data[@offset=1948] -o "," -v //_:data[@offset=1952] -o "," -v //_:data[@offset=1956] -o "," -v //_:data[@offset=1960] -o "," -v //_:data[@offset=1964] -o "," -v //_:data[@offset=1968] -o "," -v //_:data[@offset=1972] -n
